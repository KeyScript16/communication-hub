<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css.css">
    <title>Sign Up</title>
</head>
<body>
    <div id="auth-container">
        <h1>Create Account</h1>
        <input type="text" id="signup-user" placeholder="Username">
        <input type="email" id="signup-email" placeholder="Email">
        <input type="password" id="signup-pass" placeholder="Password">
        <button onclick="createAccount()">Sign Up</button>
        <p><a href="index.html">Back to Hub</a></p>
    </div>
    <script>
async function createAccount() {
    const user = document.getElementById('signup-user').value;
    const email = document.getElementById('signup-email').value;
    const pass = document.getElementById('signup-pass').value;
    
    if(user && email && pass) {
        try {
            // 1. Get current list from your LIVE Render server
            const response = await fetch('https://crescendo-chat.onrender.com');
            let allUsers = await response.json();

            // 2. Add the new user with a blank friends and requests list
            const newUser = { 
                username: user, 
                email: email, 
                password: pass, 
                friends: [], 
                requests: [] 
            };
            allUsers.push(newUser);

            // 3. Save to the LIVE Render database
            await fetch('https://crescendo-chat.onrender.com', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(allUsers)
            });

            sessionStorage.setItem("currentUser", JSON.stringify({
                email: email, 
                username: user
            }));
            
            window.location.href = 'dashboard.html';

        } catch (err) {
            alert("Error connecting to Crescendo-Chat server!");
            console.error(err);
        }
    } else {
        alert("Please fill in all fields.");
    }
}
document.addEventListener("keypress", (e) => { if(e.key === "Enter") createAccount(); });

    </script>
</body>
</html>
