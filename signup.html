<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css.css">
    <title>Sign Up</title>
</head>
<body>
    <div id="auth-container">
        <h1>Create Account</h1>
        <input type="text" id="signup-user" placeholder="Username">
        <input type="email" id="signup-email" placeholder="Email">
        <input type="password" id="signup-pass" placeholder="Password">
        <button type="button" onclick="createAccount()">Sign Up</button>
        <p><a href="index.html">Back to Hub</a></p>
    </div>

    <script>
async function createAccount() {
    const user = document.getElementById('signup-user').value;
    const email = document.getElementById('signup-email').value;
    const pass = document.getElementById('signup-pass').value;
    
    if(user && email && pass) {
        try {
            // 1. Get the data from the correct JSON route
            const response = await fetch('https://crescendo-chat.onrender.com'); 
            
            if (!response.ok) {
                throw new Error("Server returned an HTML page instead of JSON. Check your routes!");
            }

            let allUsers = await response.json();

            // Safety check: if database is empty, start a new list
            if (!Array.isArray(allUsers)) {
                allUsers = [];
            }

            const newUser = { 
                username: user, 
                email: email, 
                password: pass, 
                friends: [], 
                requests: [] 
            };
            allUsers.push(newUser);

            // 2. Save the data to the correct POST route
            const saveResponse = await fetch('https://crescendo-chat.onrender.com', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(allUsers)
            });

            if (saveResponse.ok) {
                sessionStorage.setItem("currentUser", JSON.stringify({
                    email: email, 
                    username: user
                }));
                
                // Ensure this file is also lowercase on GitHub!
                window.location.href = 'dashboard.html';
            } else {
                alert("Failed to save account to database.");
            }

        } catch (err) {
            alert("Error connecting to Crescendo-Chat server!");
            console.error("Signup Detail Error:", err);
        }
    } else {
        alert("Please fill in all fields.");
    }
}

// Allow Enter key to submit
document.addEventListener("keypress", (e) => { 
    if(e.key === "Enter") createAccount(); 
});
    </script>
</body>
</html>


